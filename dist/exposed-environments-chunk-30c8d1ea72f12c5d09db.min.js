"use strict";(self.webpackChunkconsole_gitops_plugin=self.webpackChunkconsole_gitops_plugin||[]).push([[317],{5052:(e,t,n)=>{n.r(t),n.d(t,{default:()=>R});var l=n(7993),a=n(7206),o=n(5316),i=n.n(o),r=n(733),c=n(9652),s=n(5179),u=n(9955),p=n(690),m=n(4605),d=function(e,t,n,l){return new(n||(n=Promise))((function(a,o){function i(e){try{c(l.next(e))}catch(e){o(e)}}function r(e){try{c(l.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}c((l=l.apply(e,t||[])).next())}))};Error,Error;var v=n(745),h=n(2149),E=n(9240);const g=({emptyStateMsg:e})=>l.createElement(h.EmptyState,{variant:h.EmptyStateVariant.full},l.createElement(h.EmptyStateIcon,{variant:"container",component:E.TF}),l.createElement(h.EmptyStateBody,null,e));var f=n(42),y=n.n(f);y()("pf-m-width-20"),y()("pf-m-width-30"),y()("pf-m-hidden","pf-m-visible-on-md","pf-m-width-20"),y()("pf-m-hidden","pf-m-visible-on-lg","pf-m-width-30");const S=({hasSyncStatus:e,columns:t})=>l.createElement(v.Thead,null,l.createElement(v.Th,{hasRightBorder:!0,width:10,rowSpan:1},"Application name"),l.createElement(v.Th,{hasRightBorder:!0,width:10,rowSpan:1},"Git repository"),l.createElement(v.Th,{hasRightBorder:!0,width:10,rowSpan:1},"Environment status"),l.createElement(v.Th,{hasRightBorder:!0,width:10,rowSpan:1},"Last deployment")),w=({appGroups:e,emptyStateMsg:t})=>{const n=(null==e?void 0:e.some((({sync_status:e})=>e)))||!1;return l.createElement("div",{className:"gop-gitops-list"},!t&&e?l.createElement(l.Fragment,null,l.createElement(v.OuterScrollContainer,null,l.createElement(v.InnerScrollContainer,null,l.createElement(v.TableComposable,{"aria-label":"Applications table",variant:"compact",isStickyHeader:!0},l.createElement(S,{hasSyncStatus:n}),l.createElement(v.Tbody,null,e.map((e=>{l.createElement(l.Fragment,null,l.createElement(v.Td,{key:e.name},l.createElement("div",null,l.createElement("span",null,e.name))),l.createElement(v.Td,{width:10},l.createElement("div",null,e.repo_url)),l.createElement(v.Td,null,e.sync_status),l.createElement(v.Td,null,e.last_deployed))}))))))):l.createElement(g,{emptyStateMsg:t}))};const T={isList:!0,kind:"Project",optional:!0},R=()=>{const[e,t]=l.useState(null),[n,o]=l.useState(null),[v,h,E]=(0,c.useK8sWatchResource)(T),g="/api/gitops/pipelines",{t:f}=(0,r.useTranslation)();return l.useEffect((()=>{let e=!1;return n=void 0,l=void 0,r=function*(){if(h){const n=!E&&(e=>{const t="app.openshift.io/vcs-uri";return s.Z(e.filter((e=>{var n,l;return!!(null===(l=null===(n=e.metadata)||void 0===n?void 0:n.annotations)||void 0===l?void 0:l[t])})).map((e=>{var n,l;return null===(l=null===(n=e.metadata)||void 0===n?void 0:n.annotations)||void 0===l?void 0:l[t]})))})(v)||[],[l,i]=yield((e,t,n)=>d(void 0,void 0,void 0,(function*(){console.log("baseURLs: ",e),console.log("manifestURLs: ",t);let n=null,l=null;if(console.log("Getting app groups "),e)if(u.Z(t))n="No GitOps manifest URLs found";else{try{l=p.Z(m.Z(yield Promise.all(a.Z(t,(t=>((e,t)=>d(void 0,void 0,void 0,(function*(){var n;let l;try{const e="/api/gitops/applications";console.log("fetching "+e),l=yield(0,c.consoleFetchJSON)(`${e}?url=${t}`)}catch(n){console.log("ERROR in fetch "+n);try{l=yield(0,c.consoleFetchJSON)(`${e}&url=${t}`)}catch(e){}}return null!==(n=null==l?void 0:l.applications)&&void 0!==n?n:[]})))(e,t))))),["name"])}catch(e){}u.Z(l)&&(n="gitops-plugin~No Application groups found")}return[l,n]})))(g,n);if(e)return;t(l),o(i)}},new((i=void 0)||(i=Promise))((function(e,t){function a(e){try{c(r.next(e))}catch(e){t(e)}}function o(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,o)}c((r=r.apply(n,l||[])).next())})),()=>{e=!0};var n,l,i,r}),[g,v,E,h,f]),console.log("APP GROUPS = "+e),l.createElement(l.Fragment,null,l.createElement(i(),null,l.createElement("title",null,f("plugin__console-gitops-plugin~Environments"))),l.createElement(c.ListPageHeader,{title:f("gitops-plugin~Environments")}),e||n?l.createElement(l.Fragment,null,l.createElement(c.ListPageBody,null,f("gitops-plugin~Select an application to view the environment it's deployed in."),a.Z(e,(e=>e&&l.createElement(l.Fragment,null,l.createElement("div",null,e.name," ",e.repo_url))))),l.createElement(w,{appGroups:e,emptyStateMsg:n})):l.createElement(l.Fragment,null))}}}]);
//# sourceMappingURL=exposed-environments-chunk-30c8d1ea72f12c5d09db.min.js.map